<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudKids Learning Hub</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"> <!-- Add Poppins font -->
    <script src="https://apis.google.com/js/api.js"></script>

    <style>
        body {
            background-color: #f9f9f9; /* Lighter background color */
            color: #333; /* Text color */
            font-family: 'Poppins', sans-serif; /* Use Poppins font */
        }

        .container {
            background-color: #fff; /* White background color */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 50px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Align items vertically in the center */
        }

        .col-md-6 {
            flex: 0 0 48%;
        }

        .cloudkids-logo {
            width: 100px; /* Adjust the size of the logo */
            height: auto;
            margin-right: 20px; /* Add space between the logo and text */
        }

        h1 {
            color: #f05454; /* Light Red color */
            font-weight: bold; /* Make the title bold */
            margin-bottom: 20px; /* Add space between the title and content */
            text-align: center; /* Center the title */
            font-size: 2.5em; /* Increase font size */
        }

        .content-button {
            margin-top: 10px;
            border: none; /* Remove border */
            padding: 0; /* Remove padding */
            transition: transform 0.2s ease-in-out; /* Add a smooth transition effect */
            cursor: pointer; /* Change cursor to pointer for better user experience */
        }

        .content-button:hover {
            transform: scale(1.04); /* Enlarge the button on hover */
        }

        .content-button img {
            width: 100%; /* Make image fill the button */
            border-radius: 10px; /* Add border radius to image */
        }

        #recommendation,
        #currentScores {
            list-style-type: none;
            padding: 0;
            color: #777; /* Light text color for recommendation and scores */
        }

        #recommendation li,
        #currentScores li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="row mt-4">
        <div class="col-md-6">
            <img class="cloudkids-logo" src="{{ url_for('static', filename='assets/logo.png') }}" alt="CloudKids Logo Placeholder">
            <h1>CloudKids Preschool Learning Hub</h1>
            <h2>Selamat datang! Berikut video untuk hari ini</h2>
            <div id="content1" class="content-button"></div>
            <div id="content2" class="content-button"></div>
            <div id="content3" class="content-button"></div>
            <div id="content4" class="content-button"></div>
            <div id="content5" class="content-button"></div>
        </div>

        <div class="col-md-6">
            <h3>Learning Style Prediction</h3>
<p id="learningStyle">Learning Style: -</p>
<h3>Current Scores</h3>
<ul id="currentScores">
    <li>Visual: <span id="visualScore">0</span></li>
    <li>Auditorial: <span id="auditorialScore">0</span></li>
    <li>Kinesthetic: <span id="kinestheticScore">0</span></li>
</ul>
<h3>Recommended Content</h3>
<div id="recommendation" class="d-flex flex-wrap">
    <!-- Recommended content will be dynamically added here -->
</div>

<!-- Updated iframe container -->
<div id="youtubePlayer"></div>

<!-- Use the full version of jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>

<script>
    // Load YouTube API client
    gapi.load('client', function () {
        gapi.client.init({
            apiKey: 'AIzaSyAkE_03-zFfp5TAp6cDTmCb9rTPKmZA5pY', // Replace with your YouTube API key
            discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest']
        }).then(function () {
            console.log('YouTube API client initialized');
            // Initialize userScores to zeros
            var userScores = {'Visual': 0, 'Auditorial': 0, 'Kinesthetic': 0};
            var isVideoClicked = false; // Flag to track user interaction

            // Call updateScores after API initialization
            updateScores('Dummy Content 1', 'AjgD3CvWzS0', 'content1', userScores, isVideoClicked);
            updateScores('Dummy Content 2', 'dqTTojTija8', 'content2', userScores, isVideoClicked);
            updateScores('Dummy Content 3', 'HaEmIakO7f4', 'content3', userScores, isVideoClicked);
            updateScores('Dummy Content 4', 'WtWxOhhZWX0', 'content4', userScores, isVideoClicked);
            updateScores('Dummy Content 5', '6_2hzRopPbQ', 'content5', userScores, isVideoClicked);
        });
    });

    // Function to get video details using YouTube API
    function getVideoDetails(videoId, callback) {
        gapi.client.youtube.videos.list({
            part: 'snippet',
            id: videoId
        }).then(function (response) {
            callback(response.result.items[0].snippet);
        }, function (error) {
            console.error('Error fetching video details:', error);
        });
    }

    function updateScores(content, youtubeVideoId, buttonId, userScores, isVideoClicked) {
        getVideoDetails(youtubeVideoId, function (videoDetails) {
            // Embed YouTube video thumbnail as the button
            var thumbnailUrl = videoDetails.thumbnails.medium.url;
            $('#' + buttonId).html('<a href="https://www.youtube.com/watch?v=' + youtubeVideoId + '" target="_blank"><img src="' + thumbnailUrl + '" alt="Video Thumbnail"></a>');

            // Add a click event listener to the video button
            $('#' + buttonId).on('click', function () {
                // Set the flag to true when the button is clicked
                isVideoClicked = true;

                // Perform the AJAX request when the button is clicked
                $.ajax({
                    type: 'POST',
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify({'content': content}),
                    url: 'http://127.0.0.1:5000/update_scores',
                    success: function (response) {
                        // Update the userScores with the received values only if the video is clicked
                        if (isVideoClicked) {
                            userScores.Visual = response.current_scores.Visual;
                            userScores.Auditorial = response.current_scores.Auditorial;
                            userScores.Kinesthetic = response.current_scores.Kinesthetic;

                            $('#learningStyle').text('Learning Style: ' + response.learning_style);
                            var recommendationList = response.recommendation.map(function (item) {
                                return '<li>' + item + '</li>';
                            });
                            $('#recommendation').html(recommendationList.join(''));

                            // Update the displayed scores
                            $('#visualScore').text(userScores.Visual);
                            $('#auditorialScore').text(userScores.Auditorial);
                            $('#kinestheticScore').text(userScores.Kinesthetic);
                        }
                    }
                });
            });
        });
    }

    // Update the recommended content section with clickable buttons
    function updateRecommendedContent(recommendation) {
        var recommendationList = recommendation.map(function (content, index) {
            var thumbnailUrl = getThumbnailUrl(content);  // Function to get YouTube thumbnail URL
            return '<div class="mr-3 mb-3">' +
                '<button class="content-button" onclick="handleContentClick(\'' + content + '\', \'' + getVideoLink(content) + '\')">' +
                '<img src="' + thumbnailUrl + '" alt="Thumbnail for ' + content + '">' +
                '</button>' +
                '<p>' + content + '</p>' +
                '</div>';
        });
        $('#recommendation').html(recommendationList.join('<br>')); // Separate by a new line
    }

    // Function to get YouTube thumbnail URL for a given content
    function getThumbnailUrl(content) {
        var videoLink = getVideoLink(content);
        var videoId = getVideoIdFromLink(videoLink);
        return 'https://img.youtube.com/vi/' + videoId + '/mqdefault.jpg';
    }

    // Function to get YouTube link for a given content
    function getVideoLink(content) {
        return content_data.loc[content_data['Content'] == content, 'YouTubeLink'].values[0];
    }

    // Function to extract video ID from YouTube link
    function getVideoIdFromLink(link) {
        var match = link.match(/[?&]v=([^&]+)/);
        return match ? match[1] : null;
    }
    // Handle click event for recommended content
    function handleContentClick(content) {
    // Add your logic here for what happens when a recommended content is clicked
    console.log('User clicked on: ' + content);
    // You may want to open the video in a modal, redirect to a new page, etc.
}

    // Call the updateRecommendedContent function when the page loads
    $(document).ready(function () {
    // Retrieve the initial recommendation from the server
    $.ajax({
        type: 'GET',
        url: 'http://127.0.0.1:5000/get_initial_recommendation',  // Adjust the URL to match your Flask route
        success: function (response) {
            // Update the recommended content based on the server response
            updateRecommendedContent(response.initial_recommendation);
        },
        error: function (error) {
            console.error('Error fetching initial recommendation:', error);
        }
    });
});
</script>

<!-- Include YouTube Data API script -->
<script src="https://apis.google.com/js/api.js"></script>


</body>
</html>